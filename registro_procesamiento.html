<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recepción en Planta - TrazaNet</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Outfit', sans-serif;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .glass-panel {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .input-group {
            position: relative;
            margin-bottom: 1.5rem;
        }

        .input-icon {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: #9ca3af;
            pointer-events: none;
        }

        .input-with-icon {
            padding-left: 2.5rem;
        }

        .status-badge {
            display: inline-flex;
            align-items: center;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .status-intacto {
            background-color: #d1fae5;
            color: #065f46;
        }

        .status-violado {
            background-color: #fee2e2;
            color: #991b1b;
        }

        .status-ausente {
            background-color: #fef3c7;
            color: #92400e;
        }

        .submit-btn {
            position: relative;
            overflow: hidden;
        }

        .submit-btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .submit-btn:hover::before {
            width: 300px;
            height: 300px;
        }

        .alert-box {
            padding: 1rem;
            border-radius: 0.5rem;
            margin-top: 1rem;
            display: none;
            animation: slideIn 0.3s ease-out;
        }

        .alert-success {
            background-color: #d1fae5;
            border-left: 4px solid #10b981;
            color: #065f46;
        }

        .alert-warning {
            background-color: #fef3c7;
            border-left: 4px solid #f59e0b;
            color: #92400e;
        }

        .alert-error {
            background-color: #fee2e2;
            border-left: 4px solid #ef4444;
            color: #991b1b;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .loading-spinner {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 0.6s linear infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }
    </style>
</head>

<body>
    <div class="glass-panel p-8 rounded-xl shadow-2xl w-full max-w-2xl">
        <div class="flex items-center justify-between mb-6">
            <h2 class="text-3xl font-bold text-gray-800 flex items-center">
                <i class="fas fa-industry mr-3 text-pink-600"></i> Recepción en Planta
            </h2>
            <span class="text-sm text-gray-500">
                <i class="fas fa-shield-alt mr-1"></i> Control de Entrada
            </span>
        </div>

        <form id="reception-form">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <!-- ID del Lote de Origen -->
                <div class="md:col-span-2">
                    <label for="lote-id-origen" class="block text-sm font-medium text-gray-700 mb-2">
                        <i class="fas fa-barcode mr-1 text-pink-500"></i> ID del Lote de Origen
                    </label>
                    <div class="input-group">
                        <i class="fas fa-qrcode input-icon"></i>
                        <input type="text" id="lote-id-origen" name="lote-id-origen" required
                            placeholder="Escanear o ingresar ID del lote"
                            class="input-with-icon mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-pink-500 focus:ring-pink-500 p-2 border">
                    </div>
                </div>

                <!-- Fecha y Hora de Recepción -->
                <div class="md:col-span-2">
                    <label for="fecha-recepcion" class="block text-sm font-medium text-gray-700 mb-2">
                        <i class="fas fa-clock mr-1 text-pink-500"></i> Fecha y Hora de Recepción
                        <span class="text-xs text-gray-500">(Crítico para cálculo de duración de tránsito)</span>
                    </label>
                    <div class="input-group">
                        <i class="fas fa-calendar-check input-icon"></i>
                        <input type="datetime-local" id="fecha-recepcion" name="fecha-recepcion" required
                            class="input-with-icon mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-pink-500 focus:ring-pink-500 p-2 border">
                    </div>
                </div>

                <!-- Peso Neto Recibido -->
                <div>
                    <label for="peso-recibido" class="block text-sm font-medium text-gray-700 mb-2">
                        <i class="fas fa-weight mr-1 text-pink-500"></i> Peso Neto Recibido (KG)
                        <span class="text-xs text-gray-500">(Parámetro de evaluación)</span>
                    </label>
                    <div class="input-group">
                        <i class="fas fa-balance-scale input-icon"></i>
                        <input type="number" id="peso-recibido" name="peso-recibido" step="0.1" min="0" required
                            placeholder="0.0"
                            class="input-with-icon mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-pink-500 focus:ring-pink-500 p-2 border">
                    </div>
                </div>

                <!-- Condición del Sello de Seguridad -->
                <div>
                    <label for="condicion-sello" class="block text-sm font-medium text-gray-700 mb-2">
                        <i class="fas fa-lock mr-1 text-pink-500"></i> Condición del Sello de Seguridad
                        <span class="text-xs text-gray-500">(Evaluación de integridad)</span>
                    </label>
                    <div class="input-group">
                        <i class="fas fa-certificate input-icon"></i>
                        <select id="condicion-sello" name="condicion-sello" required
                            class="input-with-icon mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-pink-500 focus:ring-pink-500 p-2 border">
                            <option value="">Seleccionar condición...</option>
                            <option value="Intacto">✓ Intacto</option>
                            <option value="Violado">✗ Violado</option>
                            <option value="Ausente">⚠ Ausente</option>
                        </select>
                    </div>
                </div>

                <!-- ID del Receptor -->
                <div class="md:col-span-2">
                    <label for="id-receptor" class="block text-sm font-medium text-gray-700 mb-2">
                        <i class="fas fa-user-check mr-1 text-pink-500"></i> ID del Receptor
                        <span class="text-xs text-gray-500">(Persona que firma la recepción)</span>
                    </label>
                    <div class="input-group">
                        <i class="fas fa-id-card input-icon"></i>
                        <input type="text" id="id-receptor" name="id-receptor" required
                            placeholder="ID del operador que recibe"
                            class="input-with-icon mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-pink-500 focus:ring-pink-500 p-2 border">
                    </div>
                </div>
            </div>

            <!-- Alert Box -->
            <div id="alert-box" class="alert-box"></div>

            <!-- Submit Button -->
            <button type="submit"
                class="submit-btn w-full mt-6 py-3 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-gradient-to-r from-pink-500 to-rose-500 hover:from-pink-600 hover:to-rose-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-pink-500 transition duration-150">
                <i class="fas fa-check-circle mr-2"></i>
                <span id="btn-text">Registrar Recepción y Transferir Custodia</span>
                <span id="btn-spinner" class="loading-spinner ml-2" style="display: none;"></span>
            </button>

            <!-- Info Box -->
            <div class="mt-4 p-4 bg-blue-50 border-l-4 border-blue-400 rounded">
                <div class="flex">
                    <div class="flex-shrink-0">
                        <i class="fas fa-info-circle text-blue-400"></i>
                    </div>
                    <div class="ml-3">
                        <p class="text-sm text-blue-700">
                            <strong>Acción del Sistema:</strong> Al enviar, se registrará un evento de tipo
                            <code class="bg-blue-100 px-1 rounded">CustodyTransfer</code> en la blockchain y se
                            ejecutará el Smart Contract de Integridad Logística para validar
                            <strong>Peso Salida vs. Peso Recepción</strong>.
                        </p>
                    </div>
                </div>
            </div>
        </form>
    </div>

    <script>
        // Set current date/time as default
        document.addEventListener('DOMContentLoaded', function () {
            const now = new Date();
            now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
            document.getElementById('fecha-recepcion').value = now.toISOString().slice(0, 16);
        });

        // Visual feedback for seal condition selection
        document.getElementById('condicion-sello').addEventListener('change', function (e) {
            const value = e.target.value;
            const alertBox = document.getElementById('alert-box');

            if (value === 'Violado' || value === 'Ausente') {
                alertBox.className = 'alert-box alert-warning';
                alertBox.innerHTML = `
                    <i class="fas fa-exclamation-triangle mr-2"></i>
                    <strong>Alerta de Seguridad:</strong> Se ha detectado una condición anómala en el sello. 
                    Se activará una revisión adicional del lote.
                `;
                alertBox.style.display = 'block';
            } else if (value === 'Intacto') {
                alertBox.className = 'alert-box alert-success';
                alertBox.innerHTML = `
                    <i class="fas fa-check-circle mr-2"></i>
                    <strong>Verificación Exitosa:</strong> El sello de seguridad está intacto.
                `;
                alertBox.style.display = 'block';
            } else {
                alertBox.style.display = 'none';
            }
        });

        // Form submission handler
        document.getElementById('reception-form').addEventListener('submit', async function (e) {
            e.preventDefault();

            const btnText = document.getElementById('btn-text');
            const btnSpinner = document.getElementById('btn-spinner');
            const alertBox = document.getElementById('alert-box');
            const submitBtn = e.target.querySelector('button[type="submit"]');

            // Disable button and show loading state
            submitBtn.disabled = true;
            btnText.textContent = 'Procesando...';
            btnSpinner.style.display = 'inline-block';

            // Collect form data
            const formData = {
                loteIdOrigen: document.getElementById('lote-id-origen').value,
                fechaHoraRecepcion: document.getElementById('fecha-recepcion').value,
                pesoNetoRecibidoKg: parseFloat(document.getElementById('peso-recibido').value),
                condicionSello: document.getElementById('condicion-sello').value,
                idUsuarioReceptor: document.getElementById('id-receptor').value,
                tipoEvento: 'CustodyTransfer',
                fase: 'Procesamiento',
                timestamp: new Date().toISOString()
            };

            try {
                // TODO: Replace with actual API endpoint
                // const response = await fetch('http://localhost:3000/api/register-reception', {
                //     method: 'POST',
                //     headers: {
                //         'Content-Type': 'application/json',
                //     },
                //     body: JSON.stringify(formData)
                // });

                // Simulate API call
                await new Promise(resolve => setTimeout(resolve, 1500));

                // Simulate weight validation
                const weightDifference = Math.random() * 5; // Simulated difference
                const isWeightValid = weightDifference < 2; // Less than 2kg difference is acceptable

                // Show success message
                alertBox.className = 'alert-box alert-success';
                alertBox.innerHTML = `
                    <div class="flex items-start">
                        <i class="fas fa-check-circle text-green-600 mr-3 mt-1"></i>
                        <div>
                            <strong>Recepción Registrada Exitosamente</strong>
                            <ul class="mt-2 text-sm list-disc list-inside">
                                <li>Evento de transferencia de custodia registrado en blockchain</li>
                                <li>Lote: <strong>${formData.loteIdOrigen}</strong></li>
                                <li>Peso recibido: <strong>${formData.pesoNetoRecibidoKg} KG</strong></li>
                                <li>Condición del sello: <strong>${formData.condicionSello}</strong></li>
                                <li>Smart Contract ejecutado: ${isWeightValid ?
                        '<span class="text-green-700">✓ Validación de peso exitosa</span>' :
                        '<span class="text-yellow-700">⚠ Diferencia de peso detectada</span>'}</li>
                            </ul>
                        </div>
                    </div>
                `;
                alertBox.style.display = 'block';

                // Reset form after 3 seconds
                setTimeout(() => {
                    e.target.reset();
                    alertBox.style.display = 'none';
                    const now = new Date();
                    now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
                    document.getElementById('fecha-recepcion').value = now.toISOString().slice(0, 16);
                }, 3000);

            } catch (error) {
                console.error('Error al registrar recepción:', error);
                alertBox.className = 'alert-box alert-error';
                alertBox.innerHTML = `
                    <i class="fas fa-exclamation-circle mr-2"></i>
                    <strong>Error:</strong> No se pudo registrar la recepción. Por favor, intente nuevamente.
                `;
                alertBox.style.display = 'block';
            } finally {
                // Re-enable button
                submitBtn.disabled = false;
                btnText.textContent = 'Registrar Recepción y Transferir Custodia';
                btnSpinner.style.display = 'none';
            }
        });
    </script>
</body>

</html>