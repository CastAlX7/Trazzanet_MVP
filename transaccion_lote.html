<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Transferencia de Lote - TrazzaNet</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Fuentes e Iconos -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">
    
    <!-- Configuración Tailwind -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Outfit', 'sans-serif'],
                        mono: ['Fira Code', 'monospace'],
                    },
                    colors: {
                        trazza: {
                            bg: '#011c16',      
                            card: 'rgba(255, 255, 255, 0.03)',
                            border: 'rgba(255, 255, 255, 0.05)',
                            primary: '#10B981', 
                            glow: '#34D399',    
                        }
                    }
                }
            }
        }
    </script>

    <style>
        body {
            background-color: #011c16;
            background-image: 
                radial-gradient(circle at 0% 0%, rgba(16, 185, 129, 0.08) 0%, transparent 40%),
                radial-gradient(circle at 100% 100%, rgba(6, 78, 59, 0.1) 0%, transparent 40%);
            min-height: 100vh;
            color: #e2e8f0;
            overflow-x: hidden;
        }

        .grid-bg {
            position: fixed;
            inset: 0;
            background-image: 
                linear-gradient(rgba(16, 185, 129, 0.02) 1px, transparent 1px),
                linear-gradient(90deg, rgba(16, 185, 129, 0.02) 1px, transparent 1px);
            background-size: 40px 40px;
            z-index: -1;
            pointer-events: none;
        }

        /* Glassmorphism */
        .glass-panel {
            background: linear-gradient(145deg, rgba(255, 255, 255, 0.03) 0%, rgba(255, 255, 255, 0.01) 100%);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.05);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
        }

        /* Inputs */
        .tech-input {
            background: rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: white;
            transition: all 0.3s ease;
        }
        .tech-input:focus {
            background: rgba(0, 0, 0, 0.4);
            border-color: #10B981;
            box-shadow: 0 0 0 1px rgba(16, 185, 129, 0.2);
            outline: none;
        }
        .tech-input:disabled {
            background: rgba(255, 255, 255, 0.05);
            color: #9ca3af;
            cursor: not-allowed;
        }

        /* Warning Banner */
        .warning-banner {
            background: rgba(245, 158, 11, 0.1);
            border-left: 4px solid #f59e0b;
            color: #fbbf24;
        }

        /* Info Footer */
        .info-footer {
            border-left: 4px solid #10B981;
            background: rgba(16, 185, 129, 0.05);
        }
    </style>
</head>

<body class="flex flex-col min-h-screen">

    <div class="grid-bg"></div>

    <!-- Top Navigation Bar -->
    <nav class="w-full z-20 px-6 py-4 flex justify-between items-center border-b border-white/5 bg-[#011c16]/80 backdrop-blur-sm sticky top-0">
        <div class="flex items-center gap-3">
            <div class="w-10 h-10 flex items-center justify-center bg-emerald-900/50 rounded-lg border border-emerald-500/30 text-emerald-400">
                <svg class="w-6 h-6" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M50 8 L88 28 V72 L50 92 L12 72 V28 L50 8Z" stroke="currentColor" stroke-width="8" fill="none"/>
                    <circle cx="50" cy="50" r="12" fill="currentColor"/>
                </svg>
            </div>
            <span class="font-bold text-white tracking-wide text-lg">Trazza<span class="text-emerald-400">Net</span></span>
        </div>
        
        <!-- Removed User/Operator Info Block -->
        <div></div> 
    </nav>

    <!-- MAIN CONTENT -->
    <main class="w-full max-w-3xl mx-auto p-6 lg:p-10 flex-1">
        
        <!-- Header with Back Button -->
        <div class="mb-8">
            <a href="javascript:history.back()" class="inline-flex items-center text-sm text-gray-400 hover:text-emerald-400 mb-4 transition-colors group">
                <i class="fas fa-arrow-left mr-2 group-hover:-translate-x-1 transition-transform"></i> Volver
            </a>
            <h1 class="text-3xl font-bold text-white mb-2 flex items-center gap-3">
                <i class="fas fa-exchange-alt text-emerald-500"></i>
                Transferencia de Activo Digital
            </h1>
        </div>

        <!-- Transaction Form Container -->
        <div class="glass-panel rounded-2xl overflow-hidden p-8">
            
            <!-- Warning Banner -->
            <div class="warning-banner p-4 rounded-lg mb-8 flex items-start gap-3">
                <i class="fas fa-info-circle text-xl mt-0.5"></i>
                <div>
                    <h4 class="font-bold text-sm text-yellow-500">Transacción Criptográfica</h4>
                    <p class="text-xs text-yellow-200/80 mt-1">Esta operación requiere autenticación digital y es irreversible una vez confirmada en la Blockchain.</p>
                </div>
            </div>

            <form id="transfer-form" class="space-y-6">
                
                <!-- 1. ID del Activo -->
                <div>
                    <label class="block text-sm font-bold text-gray-300 mb-2 flex items-center gap-2">
                        <i class="fas fa-cube text-emerald-500"></i> ID del Activo a Transferir <span class="text-red-400">*</span>
                    </label>
                    <div class="relative">
                        <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                            <i class="fas fa-barcode text-gray-500"></i>
                        </div>
                        <input type="text" id="asset-id" class="tech-input w-full rounded-lg py-3 pl-10 pr-4 text-white font-mono" placeholder="LOTE-COMERCIAL-001">
                    </div>
                    <p class="text-xs text-gray-500 mt-1 ml-1">Ingrese el ID del lote comercial (NFT) que desea vender/transferir</p>
                </div>

                <!-- 2. Wallet Origen (Read Only) -->
                <div>
                    <label class="block text-sm font-bold text-gray-300 mb-2 flex items-center gap-2">
                        <i class="fas fa-wallet text-emerald-500"></i> Wallet Origen (Vendedor)
                    </label>
                    <div class="relative">
                        <div class="absolute inset-y-0 left-0 pl-2 flex items-center pointer-events-none">
                            <div class="w-1 h-8 bg-emerald-500 rounded-full"></div>
                        </div>
                        <div class="tech-input w-full rounded-lg py-3 pl-6 pr-10 text-gray-400 font-mono text-sm bg-black/20 border-emerald-500/20 flex items-center justify-between">
                            <span id="wallet-origin" class="truncate">Cargando...</span>
                            <i class="far fa-copy cursor-pointer hover:text-white transition"></i>
                        </div>
                    </div>
                    <p class="text-xs text-gray-500 mt-1 ml-1 flex items-center gap-1"><i class="fas fa-user"></i> Su dirección de wallet (generada automáticamente)</p>
                </div>

                <!-- 3. Wallet Destino -->
                <div>
                    <label class="block text-sm font-bold text-gray-300 mb-2 flex items-center gap-2">
                        <i class="fas fa-paper-plane text-emerald-500"></i> Wallet Destino (Comprador) <span class="text-red-400">*</span>
                    </label>
                    <div class="relative">
                        <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                            <i class="fas fa-address-card text-gray-500"></i>
                        </div>
                        <input type="text" id="wallet-dest" class="tech-input w-full rounded-lg py-3 pl-10 pr-4 text-white font-mono text-sm" placeholder="0x...">
                    </div>
                    <p class="text-xs text-yellow-500/80 mt-1 ml-1 flex items-center gap-1"><i class="fas fa-exclamation-triangle"></i> Verifique cuidadosamente la dirección del comprador</p>
                </div>

                <!-- 4. Monto Transacción -->
                <div>
                    <label class="block text-sm font-bold text-gray-300 mb-2 flex items-center gap-2">
                        <i class="fas fa-dollar-sign text-emerald-500"></i> Monto de la Transacción (USD) <span class="text-red-400">*</span>
                    </label>
                    <div class="relative">
                        <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                            <i class="fas fa-money-bill-wave text-gray-500"></i>
                        </div>
                        <input type="number" id="amount" step="0.01" class="tech-input w-full rounded-lg py-3 pl-10 pr-4 text-white font-bold text-lg" placeholder="0.00">
                    </div>
                </div>

                <!-- 5. Gas Fee / Total Box -->
                <div class="bg-white/5 rounded-xl p-4 border border-dashed border-white/10">
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-sm text-gray-400">Tarifa de Gas (estimada):</span>
                        <span class="text-sm text-white font-mono">$0.50</span>
                    </div>
                    <div class="flex justify-between items-center pt-2 border-t border-white/10">
                        <span class="text-base font-bold text-white">Total a Recibir:</span>
                        <span class="text-xl font-bold text-emerald-400" id="total-receive">$0.00</span>
                    </div>
                </div>

                <!-- 6. Firma Digital -->
                <div class="pt-4">
                    <label class="block text-sm font-bold text-gray-300 mb-2 flex items-center gap-2">
                        <i class="fas fa-key text-red-400"></i> Firma Digital / PIN de Autorización <span class="text-red-400">*</span>
                    </label>
                    <div class="relative">
                        <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                            <i class="fas fa-lock text-gray-500"></i>
                        </div>
                        <input type="password" id="private-key" class="tech-input w-full rounded-lg py-3 pl-10 pr-10 text-white" placeholder="Ingrese su PIN o clave privada">
                        <button type="button" onclick="toggleKey()" class="absolute inset-y-0 right-0 pr-4 flex items-center text-gray-500 hover:text-white transition">
                            <i class="fas fa-eye" id="toggle-icon"></i>
                        </button>
                    </div>
                    <p class="text-xs text-red-400/80 mt-1 ml-1 flex items-center gap-1"><i class="fas fa-shield-alt"></i> Requerido para autenticación criptográfica</p>
                </div>

                <!-- 7. Submit Button -->
                <button type="submit" class="w-full bg-gradient-to-r from-emerald-600 to-teal-600 hover:from-emerald-500 hover:to-teal-500 text-white font-bold py-4 rounded-xl shadow-lg shadow-emerald-900/40 transition-all transform active:scale-[0.98] flex items-center justify-center gap-3 group relative overflow-hidden mt-4">
                    <span class="pulse-ring absolute w-full h-full rounded-xl opacity-0 group-hover:opacity-20"></span>
                    <i class="fas fa-rocket text-lg group-hover:-translate-y-1 transition-transform"></i>
                    <span class="tracking-wide">Ejecutar Transferencia Blockchain</span>
                </button>

            </form>
            
            <!-- 8. Info Footer -->
            <div class="info-footer mt-8 p-4 rounded-r-lg text-sm text-emerald-100/80 flex gap-3">
                <i class="fas fa-info-circle text-emerald-400 text-xl shrink-0"></i>
                <div>
                    <strong class="text-white block mb-1">Acción del Sistema:</strong>
                    Al confirmar, se ejecutará un <code class="bg-emerald-900/50 px-1 py-0.5 rounded text-emerald-300 font-mono text-xs">AssetTransfer</code> en la blockchain, transfiriendo la propiedad del lote al comprador y activando el <strong class="text-white">Smart Contract de Escrow</strong> para procesar el pago.
                </div>
            </div>

        </div>

    </main>

    <!-- Processing Modal -->
    <div id="processing-modal" class="hidden fixed inset-0 bg-black/90 z-50 flex flex-col items-center justify-center backdrop-blur-md transition-opacity duration-300">
        <div class="relative mb-8">
            <div class="w-24 h-24 border-4 border-emerald-900 rounded-full"></div>
            <div class="w-24 h-24 border-4 border-emerald-500 rounded-full border-t-transparent animate-spin absolute top-0 left-0"></div>
            <i class="fas fa-cube absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 text-emerald-400 text-2xl animate-pulse"></i>
        </div>
        <h2 class="text-3xl font-bold text-white mb-2 tracking-tight">Procesando en Blockchain</h2>
        <p class="text-emerald-400 font-mono text-sm bg-emerald-900/30 px-4 py-2 rounded-full border border-emerald-500/30" id="processing-step">Validando firma digital...</p>
    </div>

    <!-- Success Toast -->
    <div id="toast" class="fixed top-5 right-5 transform translate-x-full opacity-0 transition-all duration-500 z-[60]">
        <div class="bg-[#011c16] border border-emerald-500/50 text-white px-6 py-4 rounded-xl shadow-2xl flex items-center gap-4 relative overflow-hidden">
            <div class="absolute inset-0 bg-emerald-500/10"></div>
            <div class="w-10 h-10 bg-emerald-500/20 rounded-full flex items-center justify-center text-emerald-400 border border-emerald-500/30 z-10">
                <i class="fas fa-check"></i>
            </div>
            <div class="z-10">
                <h4 class="font-bold text-sm text-emerald-100">Transacción Exitosa</h4>
                <p class="text-xs text-emerald-400/70 mt-1">Hash: <span class="font-mono text-emerald-300">0x8a2...3b91</span></p>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js';
        import { getAuth, signInAnonymously, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js';
        import { getFirestore, doc, updateDoc, addDoc, collection } from 'https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js';

        let db, auth, user;

        async function init() {
            try {
                const firebaseConfig = JSON.parse(__firebase_config);
                const app = initializeApp(firebaseConfig);
                auth = getAuth(app);
                db = getFirestore(app);
                await signInAnonymously(auth);
                
                onAuthStateChanged(auth, (currentUser) => {
                    if (currentUser) {
                        user = currentUser;
                        // Removed operator display
                        // Set simulated wallet
                        document.getElementById('wallet-origin').textContent = "0x" + user.uid.replace(/\W/g, '').padEnd(40, '0').substring(0, 40);
                    }
                });
            } catch (e) { console.error(e); }
        }

        // Calculate Total
        document.getElementById('amount').addEventListener('input', (e) => {
            const val = parseFloat(e.target.value) || 0;
            const gas = 0.50;
            const total = Math.max(0, val - gas);
            document.getElementById('total-receive').textContent = `$${total.toFixed(2)}`;
        });

        // Toggle Password
        window.toggleKey = function() {
            const input = document.getElementById('private-key');
            const icon = document.getElementById('toggle-icon');
            if (input.type === "password") {
                input.type = "text";
                icon.classList.remove('fa-eye');
                icon.classList.add('fa-eye-slash');
            } else {
                input.type = "password";
                icon.classList.remove('fa-eye-slash');
                icon.classList.add('fa-eye');
            }
        }

        // Submit
        document.getElementById('transfer-form').addEventListener('submit', (e) => {
            e.preventDefault();
            const modal = document.getElementById('processing-modal');
            const step = document.getElementById('processing-step');
            
            modal.classList.remove('hidden');
            
            setTimeout(() => step.textContent = "Ejecutando Smart Contract...", 1500);
            setTimeout(() => step.textContent = "Confirmando en Bloque #18294...", 3000);
            setTimeout(() => {
                modal.classList.add('hidden');
                // Show custom toast instead of alert for better UX
                const t = document.getElementById('toast');
                t.classList.remove('translate-x-full', 'opacity-0');
                setTimeout(() => t.classList.add('translate-x-full', 'opacity-0'), 4000);

                document.getElementById('transfer-form').reset();
                document.getElementById('total-receive').textContent = "$0.00";
            }, 4500);
        });

        init();
    </script>
</body>
</html>